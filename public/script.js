const MENU=[{id:'m1',name:'Paneer Butter Masala',price:220,img:'https://picsum.photos/seed/1/400/300'},{id:'m2',name:'Veg Biryani',price:160,img:'https://picsum.photos/seed/2/400/300'},{id:'m3',name:'Chicken Curry',price:240,img:'https://picsum.photos/seed/3/400/300'},{id:'m4',name:'French Fries',price:90,img:'https://picsum.photos/seed/4/400/300'},{id:'m5',name:'Cold Drink',price:50,img:'https://picsum.photos/seed/5/400/300'}];
const menuEl=document.getElementById('menu');const cartItemsEl=document.getElementById('cartItems');const cartTotalEl=document.getElementById('cartTotal');const placeOrderBtn=document.getElementById('placeOrderBtn');const tableNoInput=document.getElementById('tableNo');let cart=[];
function renderMenu(){MENU.forEach(item=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<img src="${item.img}" alt="${item.name}"><div class="info"><h4>${item.name}</h4><p>₹${item.price}</p></div><div class="actions"><button class="btn btn-outline" onclick="addQty('${item.id}',-1)">-</button><div id="qty-${item.id}" style="font-weight:700">0</div><button class="btn btn-primary" onclick="addQty('${item.id}',1)">+</button></div>`;menuEl.appendChild(card);});}
function addQty(id,delta){const item=MENU.find(m=>m.id===id);let c=cart.find(x=>x.id===id);if(!c&&delta>0){c={...item,qty:0};cart.push(c);}if(!c)return;c.qty=Math.max(0,c.qty+delta);if(c.qty===0)cart=cart.filter(x=>x.id!==id);document.getElementById(`qty-${id}`).innerText=c.qty;renderCart();}
function renderCart(){cartItemsEl.innerHTML='';let total=0;if(cart.length===0){cartItemsEl.innerHTML='<div style="color:#666">Cart empty</div>';}else{cart.forEach(i=>{const row=document.createElement('div');row.className='row';row.innerHTML=`<div>${i.name} x ${i.qty}</div><div>₹${i.price*i.qty}</div>`;cartItemsEl.appendChild(row);total+=i.price*i.qty;});}cartTotalEl.innerText=`Total: ₹${total}`;}
placeOrderBtn.addEventListener('click',async()=>{const tableNo=tableNoInput.value.trim();if(!tableNo){alert('Please enter Table number');return;}if(cart.length===0){alert('Cart is empty');return;}const order={table:tableNo,items:cart.map(i=>({id:i.id,name:i.name,qty:i.qty,price:i.price})),total:cart.reduce((s,i)=>s+i.price*i.qty,0)};placeOrderBtn.disabled=true;placeOrderBtn.innerText='Placing...';try{const res=await fetch('/order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(order)});const data=await res.json();if(data.ok){alert('Order placed! Order ID: '+data.orderId);cart=[];MENU.forEach(m=>{const el=document.getElementById(`qty-${m.id}`);if(el)el.innerText='0';});renderCart();}else{alert('Error placing order');}}catch(err){console.error(err);alert('Network error');}finally{placeOrderBtn.disabled=false;placeOrderBtn.innerText='Place Order';}});renderMenu();renderCart();